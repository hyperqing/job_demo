<!doctype html>
<html lang="cmn-Hans-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>西洋汇招聘</title>
    <link rel="stylesheet" href="{{ asset('bootstrap/css/bootstrap.min.css') }}">
    <link href="https://cdn.bootcss.com/toastr.js/latest/css/toastr.min.css" rel="stylesheet">
    <style>
        .container-fluid {
            max-width: 1400px;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">西洋汇招聘</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
                <a class="nav-link" href="{{ path('index') }}">首页 <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{{ path('admin') }}">管理后台</a>
            </li>
        </ul>
    </div>
</nav>
<div class="container-fluid">
    <form id="candidate-form">
        <div class="row">
            <div class="col-md">
                <div class="form-group">
                    <label for="name">中文名：</label>
                    <input type="text" class="form-control" id="name" placeholder="必填" value="{{ user.name }}">
                </div>
            </div>
            <div class="col-md">
                <div class="form-group">
                    <label for="sex">性别：</label>
                    <select name="" id="sex" class="form-control" title="">
                        <option value="--" {{ user.sex=='--'?'selected':'' }}>--</option>
                        <option value="男" {{ user.sex=='男'?'selected':'' }}>男</option>
                        <option value="女" {{ user.sex=='女'?'selected':'' }}>女</option>
                    </select>
                </div>
            </div>
            <div class="col-md">
                <div class="form-nation">
                    <label for="exampleInputEmail1">民族：</label>
                    <input type="text" class="form-control" id="nation" placeholder="必填" value="{{ user.nation }}"
                           required>
                </div>
            </div>
            <div class="col-md">
                <div class="form-group">
                    <label for="birth_place">籍贯：</label>
                    <input type="text" class="form-control" id="birth_place" placeholder="必填"
                           value="{{ user.birth_place }}" required>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md">
                <div class="form-group">
                    <label for="birthday">出生日期：</label>
                    <input type="date" class="form-control" id="birthday" placeholder="必填" required
                           value="{{ user.birthday }}">
                </div>
            </div>
            <div class="col-md">
                <div class="form-group">
                    <label for="phone">联系电话：</label>
                    <input type="text" class="form-control" id="phone" placeholder="必填" required
                           value="{{ user.phone }}">
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="address">详细地址：</label>
                    <input type="text" class="form-control" id="address" placeholder="必填" value="{{ user.address }}"
                           required>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md">
                <div class="form-group">
                    <label for="working_life">工作年限：</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="working_life" placeholder="全职工作年限"
                               value="{{ user.working_life }}" required>
                        <div class="input-group-append">
                            <span class="input-group-text">年</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md">
                <div class="form-group">
                    <label for="hunyin">婚姻状况：</label>
                    <div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="hunyin" value="未婚"
                                   id="hunyin-1" {{ user.hunyin=='未婚'?'checked':'' }}>
                            <label class="form-check-label" for="hunyin-1">未婚</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="hunyin" value="已婚"
                                   id="hunyin-2" {{ user.hunyin=='已婚'?'checked':'' }}>
                            <label class="form-check-label" for="hunyin-2">已婚</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="hunyin" value="离异"
                                   id="hunyin-3" {{ user.hunyin=='离异'?'checked':'' }}>
                            <label class="form-check-label" for="hunyin-3">离异</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="hunyin" value="丧偶"
                                   id="hunyin-4" {{ user.hunyin=='丧偶'?'checked':'' }}>
                            <label class="form-check-label" for="hunyin-4">丧偶</label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md">
                <div class="form-group">
                    <label for="shengyu">生育状况：</label>
                    <div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="shengyu" value="未育"
                                   id="shengyu-1" {{ user.shengyu=='未育'?'checked':'' }}>
                            <label class="form-check-label" for="shengyu-1">未育</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="shengyu" value="在孕"
                                   id="shengyu-2" {{ user.shengyu=='在孕'?'checked':'' }}>
                            <label class="form-check-label" for="shengyu-2">在孕</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="shengyu" value="已育"
                                   id="shengyu-3" {{ user.shengyu=='已育'?'checked':'' }}>
                            <label class="form-check-label" for="shengyu-3">已育</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="edu">
            <h3>
                教育经历
                <small class="text-muted">从最高起填写，可填至中学</small>
            </h3>
            <table class="table">
                <thead>
                <tr>
                    <th>教育时间</th>
                    <th>性质</th>
                    <th>学历</th>
                    <th>学校名称</th>
                    <th>专业</th>
                </tr>
                </thead>
                <tbody>
                {% for edu in user.education %}
                    <tr>
                        <td>
                            <div class="form-inline">
                                <input type="date" name="edu_start_time[]" class="form-control"
                                       value="{{ edu.start_time }}">
                                &nbsp;至&nbsp;
                                <input type="date" name="edu_end_time[]" class="form-control"
                                       value="{{ edu.end_time }}">
                            </div>
                        </td>
                        <td>
                            <select name="edu_property[]" class="form-control">
                                <option value="--" {{ edu.property=='--'?'selected':'' }}>--</option>
                                <option value="全日制统招" {{ edu.property=='全日制统招'?'selected':'' }}>全日制统招</option>
                                <option value="函授" {{ edu.property=='函授'?'selected':'' }}>函授</option>
                            </select>
                        </td>
                        <td>
                            <select name="edu_level[]" class="form-control">
                                <option value="-">--</option>
                                <option value="本科">本科</option>
                                <option value="高中">高中</option>
                            </select>
                        </td>
                        <td>
                            <input type="text" name="edu_school_name[]" class="form-control"
                                   value="{{ edu.school_name }}">
                        </td>
                        <td>
                            <input type="text" name="edu_major[]" class="form-control" value="{{ edu.major }}">
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="job">
            <h3>
                工作/实习经历
                <small class="text-muted">从最近起填写</small>
            </h3>
            <table class="table">
                <thead>
                <tr>
                    <td>工作时间</td>
                    <td>性质</td>
                    <td>单位名称</td>
                    <td>部门职位</td>
                    <td>薪资范围</td>
                    <td>证明人及电话</td>
                </tr>
                </thead>
                <tbody>
                {% for item in user.work %}
                    <tr>
                        <td>
                            <div class="form-inline">
                                <input type="date" name="job_start_time[]" class="form-control"
                                       value="{{ item.start_time }}">
                                至
                                <input type="date" name="job_end_time[]" class="form-control"
                                       value="{{ item.end_time }}">
                            </div>
                        </td>
                        <td>
                            <select name="job_category[]" class="form-control">
                                <option value="--" {{ item.category=='--'?'selected':'' }}>--</option>
                                <option value="全职" {{ item.category=='全职'?'selected':'' }}>全职</option>
                                <option value="实习" {{ item.category=='实习'?'selected':'' }}>实习</option>
                                <option value="兼职" {{ item.category=='兼职'?'selected':'' }}>兼职</option>
                            </select>
                        </td>
                        <td>
                            <input type="text" name="job_company[]" id="" class="form-control"
                                   value="{{ item.company }}">
                        </td>
                        <td>
                            <input type="text" name="job_content[]" id="" class="form-control"
                                   value="{{ item.content }}">
                        </td>
                        <td>
                            <input type="text" name="job_salary[]" id="" class="form-control" value="{{ item.salary }}">
                        </td>
                        <td>
                            <input type="text" name="job_reterence[]" id="" class="form-control"
                                   value="{{ item.reterence }}">
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="family">
            <h3>家庭背景</h3>
            <table class="table">
                <thead>
                <tr>
                    <th>关系</th>
                    <th>姓名</th>
                    <th>单位及职业</th>
                    <th>联系电话</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>
                        <input type="text" name="" id="" class="form-control" placeholder="父母/丈夫/妻子">
                    </td>
                    <td>
                        <input type="text" name="" id="" class="form-control">
                    </td>
                    <td>
                        <input type="text" name="" id="" class="form-control" placeholder="必填">
                    </td>
                    <td>
                        <input type="text" name="" id="" class="form-control" placeholder="必填">
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="status">
            <h3>应聘情况</h3>
            <div class="row">
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="job_name">应聘职能：</label>
                        <select name="" id="job_name" class="form-control" title="" size="2">
                            <option value="PHP工程师" {{ user.job_name=='PHP工程师'?'selected':'' }}>PHP工程师</option>
                            <option value="前端工程师" {{ user.job_name=='前端工程师'?'selected':'' }}>前端工程师</option>
                            <option value="全栈工程师" {{ user.job_name=='全栈工程师'?'selected':'' }}>全栈工程师</option>
                            <option value="大数据分析" {{ user.job_name=='大数据分析'?'selected':'' }}>大数据分析</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-group">
                        <label for="job_property">应聘性质：</label>
                        <select name="" id="job_property" class="form-control" title="">
                            <option value="全职" {{ user.job_property=='全职'?'selected':'' }}>全职</option>
                            <option value="实习" {{ user.job_property=='实习'?'selected':'' }}>实习</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-group">
                        <label for="my_level">自我定位：</label>
                        <select name="" id="my_level" class="form-control" title="">
                            <option value="实习生" {{ user.my_level=='实习生'?'selected':'' }}>实习生</option>
                            <option value="初级工程师" {{ user.my_level=='初级工程师'?'selected':'' }}>初级工程师</option>
                            <option value="中级工程师" {{ user.my_level=='中级工程师'?'selected':'' }}>中级工程师</option>
                            <option value="高级工程师" {{ user.my_level=='高级工程师'?'selected':'' }}>高级工程师</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-group">
                        <label for="salary_require">薪资要求：</label>
                        <input type="text" name="" id="salary_require" class="form-control"
                               value="{{ user.salary_require }}">
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="come_time">到岗时间：</label>
                        <select name="" id="come_time" class="form-control" title="">
                            <option value="随时" {{ user.come_time=='随时'?'selected':'' }}>随时</option>
                            <option value="一至三个月" {{ user.come_time=='一至三个月'?'selected':'' }}>一至三个月</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <div class="submitting my-3 text-center">
            <button type="submit" class="btn btn-primary" id="submit-btn">保存更改</button>
        </div>
    </form>
    <footer class="text-center">
        <p>Copyright@2018</p>
    </footer>
</div>
</body>
<script src=""></script>
<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="{{ asset('bootstrap/js/bootstrap.min.js') }}"></script>
<script src="https://cdn.bootcss.com/toastr.js/latest/js/toastr.min.js"></script>
<script>
    $(function () {
        // 提交表单
        $("#candidate-form").submit(function (event) {
            event.preventDefault();
            if ($("#name").val().length === 0) {
                return;
            }
            // 获取教育背景信息
            // 开始时间
            let edu_start_time = $("[name='edu_start_time[]']").map(function () {
                return this.value;
            }).get();
            // 结束时间
            let edu_end_time = $("[name='edu_end_time[]']").map(function () {
                return this.value;
            }).get();
            // 性质
            let edu_property = $("[name='edu_property[]']").map(function () {
                return this.value;
            }).get();
            // 学历
            let edu_level = $("[name='edu_level[]']").map(function () {
                return this.value;
            }).get();
            // 学校名称
            let edu_school_name = $("[name='edu_school_name[]']").map(function () {
                return this.value;
            }).get();
            // 专业
            let edu_major = $("[name='edu_major[]']").map(function () {
                return this.value;
            }).get();
            // 获取工作背景
            let job_start_time = $("[name='job_start_time[]']").map(function () {
                return this.value;
            }).get();
            let job_end_time = $("[name='job_end_time[]']").map(function () {
                return this.value;
            }).get();
            let job_category = $("[name='job_category[]']").map(function () {
                return this.value;
            }).get();
            let job_company = $("[name='job_company[]']").map(function () {
                return this.value;
            }).get();
            let job_content = $("[name='job_content[]']").map(function () {
                return this.value;
            }).get();
            let job_salary = $("[name='job_salary[]']").map(function () {
                return this.value;
            }).get();
            let job_reterence = $("[name='job_reterence[]']").map(function () {
                return this.value;
            }).get();
            // 整理教育记录
            let education = [];
            for (let i = 0; i < edu_start_time.length; i++) {
                education.push({
                    start_time: edu_start_time[i],
                    end_time: edu_end_time[i],
                    property: edu_property[i],
                    level: edu_level[i],
                    school_name: edu_school_name[i],
                    major: edu_major[i],
                })
            }
            // 整理工作记录
            let work = [];
            for (let i = 0; i < job_start_time.length; i++) {
                work.push({
                    start_time: job_start_time[i],
                    end_time: job_end_time[i],
                    category: job_category[i],
                    company: job_company[i],
                    content: job_content[i],
                    salary: job_salary[i],
                    reterence: job_reterence[i],
                })
            }
            $.ajax({
                url: "{{ path("candidate/update") }}",
                type: "post",
                dataType: "json",
                data: {
                    _id: "{{ user._id }}",
                    name: $("#name").val(),
                    sex: $("#sex").val(),
                    nation: $("#nation").val(),
                    birth_place: $("#birth_place").val(),

                    birthday: $("#birthday").val(),
                    phone: $("#phone").val(),
                    address: $("#address").val(),

                    working_life: $("#working_life").val(),
                    hunyin: $("[name=hunyin]:checked").val(),
                    shengyu: $("[name=shengyu]:checked").val(),

                    education: education,
                    work: work,

                    job_name: $("#job_name").val(),
                    job_property: $("#job_property").val(),
                    my_level: $("#my_level").val(),
                    salary_require: $("#salary_require").val(),
                    come_time: $("#come_time").val(),
                },
                success: function (res) {
                    console.log(res);
                    if (res.status === 1) {
                        toastr.success(res.info);
                    } else {
                        toastr.error(res.info);
                    }
                },
                error: function () {

                }
            });
        });
    })
</script>
</html>